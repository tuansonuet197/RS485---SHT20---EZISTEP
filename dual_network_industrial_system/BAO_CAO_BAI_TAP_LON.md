---
# BÃO CÃO BÃ€I Táº¬P Lá»šN

## Äáº I Há»ŒC QUá»C GIA HÃ€ Ná»˜I
## TRÆ¯á»œNG Äáº I Há»ŒC CÃ”NG NGHá»†

---

### BÃ€I Táº¬P Lá»šN MÃ”N Há»ŒC
# KIáº¾N TRÃšC MÃY TÃNH VÃ€ Máº NG TRUYá»€N THÃ”NG CÃ”NG NGHIá»†P

**Äá» tÃ i:**  
# Há»† THá»NG GIÃM SÃT VÃ€ ÄIá»€U KHIá»‚N CÃ”NG NGHIá»†P  
# QUA 2 Máº NG RS-485 Äá»˜C Láº¬P

---

**Giáº£ng viÃªn hÆ°á»›ng dáº«n:**
- ThS. Äáº·ng Anh Viá»‡t
- ThS. Nguyá»…n Quang NhÃ£

**Sinh viÃªn thá»±c hiá»‡n:**
- Há» vÃ  tÃªn: Nguyá»…n Tuáº¥n SÆ¡n
- MÃ£ sinh viÃªn: 23021335

**Lá»›p há»c pháº§n:** INT 2013 44  
**Há»c ká»³:** I - NÄƒm há»c 2024-2025

---

HÃ  Ná»™i, ThÃ¡ng 11/2025

---
---

# Lá»œI Ná»I Äáº¦U

*(Ná»™i dung sáº½ bá»• sung - 0.5 Ä‘áº¿n 1 trang)*

## LÃ½ do chá»n Ä‘á» tÃ i

## Má»¥c tiÃªu chung cá»§a bÃ i táº­p lá»›n

## Cáº¥u trÃºc bÃ¡o cÃ¡o

---
---

# Má»¤C Lá»¤C

## CHÆ¯Æ NG 1. Tá»”NG QUAN
1.1. Tá»•ng quan vá» giao thá»©c truyá»n thÃ´ng cÃ´ng nghiá»‡p Modbus  
1.2. Giá»›i thiá»‡u thiáº¿t bá»‹ Ä‘Æ°á»£c sá»­ dá»¥ng trong bÃ i táº­p lá»›n  
&nbsp;&nbsp;&nbsp;&nbsp;1.2.1. Cáº£m biáº¿n SHT20  
&nbsp;&nbsp;&nbsp;&nbsp;1.2.2. Driver Ä‘á»™ng cÆ¡ Ezi-STEP Plus-R  
&nbsp;&nbsp;&nbsp;&nbsp;1.2.3. Giao diá»‡n RS-485  
1.3. Ã tÆ°á»Ÿng cáº¥u hÃ¬nh máº¡ng truyá»n thÃ´ng cÃ´ng nghiá»‡p  
&nbsp;&nbsp;&nbsp;&nbsp;1.3.1. Kiáº¿n trÃºc máº¡ng kÃ©p Ä‘á»™c láº­p  
&nbsp;&nbsp;&nbsp;&nbsp;1.3.2. CÃ¡c váº¥n Ä‘á» khÃ³ khÄƒn trong khi lÃ m BTL  
&nbsp;&nbsp;&nbsp;&nbsp;1.3.3. Æ¯u vÃ  nhÆ°á»£c Ä‘iá»ƒm cá»§a há»‡ thá»‘ng MTTCN Ä‘Ã£ lá»±a chá»n  

## CHÆ¯Æ NG 2. Tá»” CHá»¨C Máº NG TRUYá»€N THÃ”NG CÃ”NG NGHIá»†P
2.1. SÆ¡ Ä‘á»“ khá»‘i káº¿t ná»‘i cá»§a há»‡ thá»‘ng  
2.2. SÆ¡ Ä‘á»“ nguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng MTTCN  
&nbsp;&nbsp;&nbsp;&nbsp;2.2.1. SÆ¡ Ä‘á»“ khá»‘i thuáº­t toÃ¡n  
&nbsp;&nbsp;&nbsp;&nbsp;2.2.2. SÆ¡ Ä‘á»“ logic Ä‘iá»u khiá»ƒn  
2.3. CÃ¡ch thá»©c truyá»n nháº­n dá»¯ liá»‡u cá»§a há»‡ thá»‘ng  
&nbsp;&nbsp;&nbsp;&nbsp;2.3.1. Truyá»n nháº­n dá»¯ liá»‡u Master - Slave 1 (SHT20)  
&nbsp;&nbsp;&nbsp;&nbsp;2.3.2. Truyá»n nháº­n dá»¯ liá»‡u Master - Slave 2 (Ezi-STEP)  
&nbsp;&nbsp;&nbsp;&nbsp;2.3.3. Bá»‘n vÃ­ dá»¥ minh há»a chi tiáº¿t  
2.4. Há»‡ thá»‘ng Automation thÃ´ng minh  
&nbsp;&nbsp;&nbsp;&nbsp;2.4.1. Kiáº¿n trÃºc Automation System  
&nbsp;&nbsp;&nbsp;&nbsp;2.4.2. CÃ¡c quy táº¯c automation (Rules)  
&nbsp;&nbsp;&nbsp;&nbsp;2.4.3. TÃ­nh nÄƒng nÃ¢ng cao  
&nbsp;&nbsp;&nbsp;&nbsp;2.4.4. Code implementation  
&nbsp;&nbsp;&nbsp;&nbsp;2.4.5. VÃ­ dá»¥ hoáº¡t Ä‘á»™ng thá»±c táº¿  

## CHÆ¯Æ NG 3. Káº¾T LUáº¬N
3.1. TÃ³m táº¯t má»¥c tiÃªu vÃ  ná»™i dung Ä‘Ã£ thá»±c hiá»‡n  
3.2. ÄÃ¡nh giÃ¡ nhá»¯ng gÃ¬ Ä‘Ã£ lÃ m Ä‘Æ°á»£c  
3.3. ÄÃ¡nh giÃ¡ Æ°u nhÆ°á»£c Ä‘iá»ƒm cá»§a Ä‘á» tÃ i  
3.4. Má»©c Ä‘á»™ hoÃ n thÃ nh so vá»›i yÃªu cáº§u  
3.5. Äá» xuáº¥t phÃ¡t triá»ƒn trong tÆ°Æ¡ng lai  

## TÃ€I LIá»†U THAM KHáº¢O

## PHá»¤ Lá»¤C
Phá»¥ lá»¥c A: ChÆ°Æ¡ng trÃ¬nh code Ä‘áº§y Ä‘á»§  
Phá»¥ lá»¥c B: HÃ¬nh áº£nh mÃ´ hÃ¬nh thá»±c táº¿  
Phá»¥ lá»¥c C: Datasheet thiáº¿t bá»‹  

---
---

# CHÆ¯Æ NG 1. Tá»”NG QUAN

## 1.1. Tá»•ng quan vá» giao thá»©c truyá»n thÃ´ng cÃ´ng nghiá»‡p Modbus

*(Ná»™i dung sáº½ bá»• sung)*

### 1.1.1. Giá»›i thiá»‡u vá» Modbus RTU
- Lá»‹ch sá»­ phÃ¡t triá»ƒn
- Äáº·c Ä‘iá»ƒm chÃ­nh
- á»¨ng dá»¥ng trong cÃ´ng nghiá»‡p

### 1.1.2. Cáº¥u trÃºc gÃ³i tin Modbus RTU
- Frame format
- Function codes
- CRC-16 checksum

### 1.1.3. MÃ´ hÃ¬nh Master-Slave

### 1.1.4. Táº§ng váº­t lÃ½ RS-485
- Äáº·c Ä‘iá»ƒm ká»¹ thuáº­t
- Æ¯u Ä‘iá»ƒm so vá»›i RS-232
- Khoáº£ng cÃ¡ch vÃ  tá»‘c Ä‘á»™ truyá»n

---

## 1.2. Giá»›i thiá»‡u thiáº¿t bá»‹ Ä‘Æ°á»£c sá»­ dá»¥ng trong bÃ i táº­p lá»›n

*(Ná»™i dung sáº½ bá»• sung)*

### 1.2.1. Cáº£m biáº¿n SHT20
- **Cáº¥u táº¡o:**
- **ThÃ´ng sá»‘ ká»¹ thuáº­t:**
- **NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng:**
- **Káº¿t ná»‘i:**

### 1.2.2. Driver Ä‘á»™ng cÆ¡ Ezi-STEP Plus-R (Fastech)
- **Cáº¥u táº¡o:**
- **ThÃ´ng sá»‘ ká»¹ thuáº­t:**
- **NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng:**
- **Káº¿t ná»‘i:**
- **Giao thá»©c FASTECH:**

### 1.2.3. Giao diá»‡n RS-485 (USB-Serial Converter)
- **USB-Serial CH340:**
- **USB-Serial FTDI:**

---

## 1.3. Ã tÆ°á»Ÿng cáº¥u hÃ¬nh máº¡ng truyá»n thÃ´ng cÃ´ng nghiá»‡p

*(Ná»™i dung sáº½ bá»• sung)*

### 1.3.1. Kiáº¿n trÃºc máº¡ng kÃ©p Ä‘á»™c láº­p

**LÃ½ do chá»n kiáº¿n trÃºc 2 máº¡ng Ä‘á»™c láº­p:**
- TÃ¡ch biá»‡t giao thá»©c
- TÄƒng Ä‘á»™ tin cáº­y
- Dá»… dÃ ng báº£o trÃ¬

**Máº¡ng 1 - GiÃ¡m sÃ¡t mÃ´i trÆ°á»ng:**
- Giao thá»©c: Modbus RTU
- Tá»‘c Ä‘á»™: 9600 bps
- Thiáº¿t bá»‹: SHT20 Sensor

**Máº¡ng 2 - Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡:**
- Giao thá»©c: FASTECH Protocol
- Tá»‘c Ä‘á»™: 115200 bps
- Thiáº¿t bá»‹: Ezi-STEP Plus-R Driver

### 1.3.2. CÃ¡c váº¥n Ä‘á» khÃ³ khÄƒn trong khi lÃ m BTL

**KhÃ³ khÄƒn vá» pháº§n cá»©ng:**
- Káº¿t ná»‘i RS-485 vÃ  cáº¥u hÃ¬nh DIP switch
- Nguá»“n Ä‘iá»‡n cho driver Ä‘á»™ng cÆ¡ (24V, 3A)
- CÃ i Ä‘áº·t driver USB-Serial (CH340, FTDI)

**KhÃ³ khÄƒn vá» pháº§n má»m:**
- Triá»ƒn khai giao thá»©c FASTECH (byte stuffing/destuffing)
- Xá»­ lÃ½ multi-threading (2 máº¡ng song song)
- Debugging packet format vÃ  CRC-16
- **JOG Simulation:** Lá»‡nh MOVE_ABSOLUTE (0x38) vÃ  MOVE_RELATIVE (0x39) bá»‹ driver tá»« chá»‘i (0x82 ACK+ERROR) vÃ¬ thiáº¿u tham sá»‘ gia tá»‘c/giáº£m tá»‘c khÃ´ng cÃ³ trong tÃ i liá»‡u
- **Position Tracking:** Vá»‹ trÃ­ motor bá»‹ tÃ­nh sai khi dÃ¹ng JOG simulation (tÄƒng gáº¥p Ä‘Ã´i)

**KhÃ³ khÄƒn vá» giao thá»©c:**
- Motor khÃ´ng quay dÃ¹ gá»­i lá»‡nh thÃ nh cÃ´ng
- YÃªu cáº§u homing cá»§a driver
- Packet bá»‹ parse sai do thiáº¿u byte stuffing
- **Giáº£i phÃ¡p JOG Simulation:** Thay vÃ¬ dÃ¹ng lá»‡nh MOVE trá»±c tiáº¿p, sá»­ dá»¥ng JOG (0x37) + tÃ­nh thá»i gian chÃ­nh xÃ¡c (distance/speed) + STOP Ä‘á»ƒ Ä‘áº¡t vá»‹ trÃ­ mong muá»‘n
- **PhÃ¢n biá»‡t JOG thuáº§n tÃºy vs JOG Simulation:** ThÃªm flag `is_simulation` Ä‘á»ƒ tracking position Ä‘Ãºng cho má»—i trÆ°á»ng há»£p

### 1.3.3. Æ¯u vÃ  nhÆ°á»£c Ä‘iá»ƒm cá»§a há»‡ thá»‘ng MTTCN Ä‘Ã£ lá»±a chá»n

**Æ¯u Ä‘iá»ƒm:**
- âœ… Hai máº¡ng Ä‘á»™c láº­p: khÃ´ng áº£nh hÆ°á»Ÿng láº«n nhau
- âœ… Modbus RTU: giao thá»©c chuáº©n cÃ´ng nghiá»‡p, dá»… má»Ÿ rá»™ng
- âœ… RS-485: khoáº£ng cÃ¡ch xa (1200m), chá»‘ng nhiá»…u tá»‘t
- âœ… Multi-threading: hiá»‡u suáº¥t cao, GUI responsive
- âœ… Dá»… dÃ ng thÃªm thiáº¿t bá»‹ má»›i vÃ o má»—i máº¡ng

**NhÆ°á»£c Ä‘iá»ƒm:**
- âŒ Cáº§n 2 cá»•ng COM riÃªng biá»‡t (2 USB-Serial converter)
- âŒ Giao thá»©c FASTECH phá»©c táº¡p (byte stuffing, proprietary)
- âŒ Driver Ezi-STEP yÃªu cáº§u cáº¥u hÃ¬nh parameter phá»©c táº¡p
- âŒ Chi phÃ­ cao hÆ¡n so vá»›i máº¡ng Ä‘Æ¡n

---
---

# CHÆ¯Æ NG 2. Tá»” CHá»¨C Máº NG TRUYá»€N THÃ”NG CÃ”NG NGHIá»†P

## 2.1. SÆ¡ Ä‘á»“ khá»‘i káº¿t ná»‘i cá»§a há»‡ thá»‘ng

### 2.1.1. Kiáº¿n trÃºc 3 táº§ng theo chuáº©n cÃ´ng nghiá»‡p

Há»‡ thá»‘ng Ä‘Æ°á»£c thiáº¿t káº¿ theo **mÃ´ hÃ¬nh 3 táº§ng tá»± Ä‘á»™ng hÃ³a cÃ´ng nghiá»‡p** (Pyramid of Automation):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Táº¦NG 3: SUPERVISION & MONITORING LEVEL (Táº§ng giÃ¡m sÃ¡t)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PyQt5 GUI Application - HMI Interface                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Tab 1: SHT20 â”‚  â”‚ Tab 2: Motor â”‚  â”‚ Tab 3: Automationâ”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Graphs     â”‚  â”‚ - Control    â”‚  â”‚ - Status & Rules â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ - Display    â”‚  â”‚ - Monitor    â”‚  â”‚ - Activity Log   â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Chá»©c nÄƒng:                                                   â”‚  â”‚
â”‚  â”‚  â€¢ Hiá»ƒn thá»‹ dá»¯ liá»‡u real-time (nhiá»‡t Ä‘á»™, Ä‘á»™ áº©m, vá»‹ trÃ­ motor)â”‚  â”‚
â”‚  â”‚  â€¢ Data visualization (Ä‘á»“ thá»‹, LCD numbers)                  â”‚  â”‚
â”‚  â”‚  â€¢ Data logging (CSV export)                                 â”‚  â”‚
â”‚  â”‚  â€¢ Giao diá»‡n Ä‘iá»u khiá»ƒn thá»§ cÃ´ng                             â”‚  â”‚
â”‚  â”‚  â€¢ GiÃ¡m sÃ¡t tráº¡ng thÃ¡i automation                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–² â”‚
                   Signal/Slot (PyQt5)
                             â”‚ â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Táº¦NG 2: CONTROL & AUTOMATION LEVEL (Táº§ng Ä‘iá»u khiá»ƒn)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AutomationController Module (logic/automation_simple.py)    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  4 Automation Rules (Decision Logic):                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Rule 1: IF Temp > 28Â°C  â†’ Motor ON (CW, 8000pps)   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Rule 2: IF Temp < 26Â°C  â†’ Motor OFF                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Rule 3: IF Humid > 65%  â†’ Motor OFF                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Rule 4: IF Humid < 40%  â†’ Motor ON (CW, 5000pps)   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Master RS-485 Communication Drivers:                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚  â”‚ drivers/             â”‚  â”‚ drivers/             â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ sht20_modbus.py      â”‚  â”‚ ezistep_fastech.py   â”‚         â”‚  â”‚
â”‚  â”‚  â”‚ (Modbus RTU Master)  â”‚  â”‚ (FASTECH Master)     â”‚         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Chá»©c nÄƒng:                                                   â”‚  â”‚
â”‚  â”‚  â€¢ Xá»­ lÃ½ logic Ä‘iá»u khiá»ƒn tá»± Ä‘á»™ng (IF-THEN-ELSE)             â”‚  â”‚
â”‚  â”‚  â€¢ Ra quyáº¿t Ä‘á»‹nh dá»±a trÃªn dá»¯ liá»‡u sensor                     â”‚  â”‚
â”‚  â”‚  â€¢ Gá»­i lá»‡nh Ä‘iá»u khiá»ƒn xuá»‘ng Field Level                     â”‚  â”‚
â”‚  â”‚  â€¢ Quáº£n lÃ½ giao thá»©c Modbus RTU vÃ  FASTECH                   â”‚  â”‚
â”‚  â”‚  â€¢ Master cá»§a cáº£ 2 máº¡ng RS-485                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²                            â–²
                    â”‚                            â”‚
             RS-485 Modbus RTU            RS-485 FASTECH
             COM1: 9600 bps               COM2: 115200 bps
             Data: 8 bits                 Data: 8 bits
             Parity: None                 Parity: None
             Stop: 1 bit                  Stop: 1 bit
             Slave ID: 1                  Slave ID: 2
                    â”‚                            â”‚
                    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Táº¦NG 1: FIELD LEVEL (Táº§ng hiá»‡n trÆ°á»ng - Sensors & Actuators)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SLAVE 1: SHT20 Sensor    â”‚   â”‚  SLAVE 2: Ezi-STEP Driver  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Temperature sensorâ”‚  â”‚   â”‚  â”‚ â€¢ Stepper Motor      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   (-40Â°C ~ +125Â°C)  â”‚  â”‚   â”‚  â”‚ â€¢ Position Encoder   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Humidity sensor   â”‚  â”‚   â”‚  â”‚ â€¢ Driver circuit     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚   (0% ~ 100% RH)    â”‚  â”‚   â”‚  â”‚   (24V, 4.2A/phase)  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  Modbus Slave ID: 1       â”‚   â”‚  FASTECH Slave ID: 2       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  Chá»©c nÄƒng:                                                         â”‚
â”‚  â€¢ Thu tháº­p dá»¯ liá»‡u mÃ´i trÆ°á»ng (nhiá»‡t Ä‘á»™, Ä‘á»™ áº©m)                   â”‚
â”‚  â€¢ Thá»±c thi lá»‡nh Ä‘iá»u khiá»ƒn (quay motor, dá»«ng, vá» gá»‘c)             â”‚
â”‚  â€¢ Pháº£n há»“i tráº¡ng thÃ¡i vá» Master (position, alarm, running)        â”‚
â”‚  â€¢ Giao tiáº¿p qua RS-485 (chá»‘ng nhiá»…u, khoáº£ng cÃ¡ch xa)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.1.2. Giáº£i thÃ­ch chi tiáº¿t tá»«ng táº§ng

#### **Táº¦NG 3 - SUPERVISION LEVEL (Táº§ng giÃ¡m sÃ¡t):**

**Vai trÃ²:** Táº§ng giao diá»‡n ngÆ°á»i - mÃ¡y (HMI), giÃ¡m sÃ¡t vÃ  Ä‘iá»u khiá»ƒn thá»§ cÃ´ng

**ThÃ nh pháº§n:**
- `gui/main_window.py`: Cá»­a sá»• chÃ­nh, quáº£n lÃ½ 3 tabs
- `gui/sht20_tab.py`: Tab hiá»ƒn thá»‹ nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m vá»›i Ä‘á»“ thá»‹ real-time
- `gui/ezistep_tab.py`: Tab Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡ (JOG, Move, Homing)
- `gui/automation_tab.py`: Tab giÃ¡m sÃ¡t automation vÃ  cáº¥u hÃ¬nh rules

**Chá»©c nÄƒng:**
1. **Visualization:** Äá»“ thá»‹ real-time (PyQtGraph), LCD numbers
2. **Manual Control:** NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn motor thá»§ cÃ´ng
3. **Monitoring:** Theo dÃµi tráº¡ng thÃ¡i há»‡ thá»‘ng 24/7
4. **Data Logging:** Ghi láº¡i dá»¯ liá»‡u ra file CSV Ä‘á»ƒ phÃ¢n tÃ­ch sau
5. **Alarm Display:** Hiá»ƒn thá»‹ cáº£nh bÃ¡o khi vÆ°á»£t ngÆ°á»¡ng

**CÃ´ng nghá»‡:** Python PyQt5 (Fusion style), PyQtGraph

---

#### **Táº¦NG 2 - CONTROL LEVEL (Táº§ng Ä‘iá»u khiá»ƒn):**

**Vai trÃ²:** Táº§ng logic Ä‘iá»u khiá»ƒn, ra quyáº¿t Ä‘á»‹nh tá»± Ä‘á»™ng

**ThÃ nh pháº§n:**
- `logic/automation_simple.py`: AutomationController vá»›i 4 rules
- `drivers/sht20_modbus.py`: Modbus RTU Master driver
- `drivers/ezistep_fastech.py`: FASTECH Protocol Master driver

**Chá»©c nÄƒng:**
1. **Decision Making:** 
   - Rule 1: Nhiá»‡t Ä‘á»™ cao â†’ Báº­t quáº¡t lÃ m mÃ¡t (motor CW)
   - Rule 2: Nhiá»‡t Ä‘á»™ tháº¥p â†’ Táº¯t quáº¡t (tiáº¿t kiá»‡m nÄƒng lÆ°á»£ng)
   - Rule 3/4: Äiá»u khiá»ƒn Ä‘á»™ áº©m (mÃ¡y phun sÆ°Æ¡ng)

2. **Master Communication:**
   - Polling slaves theo chu ká»³ (SHT20: 1s, Motor: 100ms)
   - Gá»­i lá»‡nh Ä‘iá»u khiá»ƒn xuá»‘ng Field Level
   - Xá»­ lÃ½ CRC, timeout, retry

3. **Protocol Handling:**
   - Modbus RTU: Function codes 0x03/0x04
   - FASTECH: Byte stuffing, custom frame format

**CÃ´ng nghá»‡:** Python threading, pyserial, pymodbus

---

#### **Táº¦NG 1 - FIELD LEVEL (Táº§ng hiá»‡n trÆ°á»ng):**

**Vai trÃ²:** Táº§ng cáº£m biáº¿n vÃ  actuator, giao tiáº¿p trá»±c tiáº¿p vá»›i mÃ´i trÆ°á»ng

**ThÃ nh pháº§n:**

**Slave 1 - SHT20 Sensor:**
- **Loáº¡i:** Digital Temperature & Humidity Sensor
- **Giao thá»©c:** Modbus RTU Slave
- **Dáº£i Ä‘o:** -40Â°C ~ +125Â°C, 0% ~ 100% RH
- **Äá»™ chÃ­nh xÃ¡c:** Â±0.3Â°C (typ), Â±3% RH (typ)
- **Response time:** < 8 seconds
- **Registers:** 0x0001 (Temp), 0x0002 (Humid)

**Slave 2 - Ezi-STEP Driver:**
- **Loáº¡i:** Stepper Motor Driver
- **Model:** EzT-NDR-42M (Fastech)
- **Giao thá»©c:** FASTECH Protocol Slave
- **Motor type:** 2-phase stepper
- **Max current:** 4.2A/phase
- **Voltage:** 24-48V DC
- **Resolution:** 1000 pulse/rev (default)
- **Commands:** SERVO ON/OFF, JOG, MOVE, HOMING, READ STATUS

**Chá»©c nÄƒng:**
1. Thu tháº­p dá»¯ liá»‡u mÃ´i trÆ°á»ng liÃªn tá»¥c
2. Thá»±c thi lá»‡nh Ä‘iá»u khiá»ƒn tá»« Master
3. Pháº£n há»“i tráº¡ng thÃ¡i hiá»‡n táº¡i (position, alarm, running)
4. Tá»± Ä‘á»™ng bÃ¡o lá»—i khi cÃ³ váº¥n Ä‘á» (overload, overheat...)

---

### 2.1.3. Luá»“ng dá»¯ liá»‡u trong há»‡ thá»‘ng 3 táº§ng

**HÆ°á»›ng lÃªn (Bottom-Up): Field â†’ Control â†’ Supervision**

```
1. SHT20 Ä‘o nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m
   â†“
2. Modbus RTU Master Ä‘á»c data (Táº§ng 2)
   â†“
3. AutomationController xá»­ lÃ½ (check rules)
   â†“
4. GUI cáº­p nháº­t hiá»ƒn thá»‹ (Táº§ng 3)
```

**HÆ°á»›ng xuá»‘ng (Top-Down): Supervision â†’ Control â†’ Field**

```
1. User click "JOG CW" trÃªn GUI (Táº§ng 3)
   â†“
2. Signal gá»­i Ä‘áº¿n EziStepDriver (Táº§ng 2)
   â†“
3. FASTECH Master gá»­i lá»‡nh 0x37 (MOVE_VELOCITY)
   â†“
4. Motor quay (Táº§ng 1)
```

**Automation Loop (Táº§ng 2 tá»± quyáº¿t Ä‘á»‹nh):**

```
1. SHT20 â†’ Temp = 29Â°C (Táº§ng 1)
   â†“
2. AutomationController: Rule 1 trigger! (Táº§ng 2)
   â†“
3. Gá»­i lá»‡nh JOG CW 8000pps â†’ Motor (Táº§ng 2 â†’ Táº§ng 1)
   â†“
4. GUI hiá»ƒn thá»‹ "Motor RUNNING (AUTO)" (Táº§ng 3)
```

---

### 2.1.4. Báº£ng thÃ´ng sá»‘ káº¿t ná»‘i chi tiáº¿t

| Táº§ng | TÃªn | CÃ´ng nghá»‡ | Giao tiáº¿p | Tá»‘c Ä‘á»™ | Role |
|------|-----|-----------|-----------|--------|------|
| 3 | PyQt5 GUI | Python, Qt5 | Signal/Slot | N/A | HMI |
| 2 | Automation Controller | Python | QThread | N/A | Logic |
| 2 | Modbus Master | pymodbus | RS-485 (COM1) | 9600 bps | Master |
| 2 | FASTECH Master | pyserial | RS-485 (COM2) | 115200 bps | Master |
| 1 | SHT20 Sensor | Modbus RTU | RS-485 | 9600 bps | Slave 1 |
| 1 | Ezi-STEP Driver | FASTECH | RS-485 | 115200 bps | Slave 2 |

**Cáº¥u hÃ¬nh serial:**
- **Máº¡ng 1:** 9600 bps, 8 data bits, No parity, 1 stop bit (8N1)
- **Máº¡ng 2:** 115200 bps, 8 data bits, No parity, 1 stop bit (8N1)

**Nguá»“n Ä‘iá»‡n:**
- Motor Power: 24V DC, 3A (cho driver + Ä‘á»™ng cÆ¡)
- Logic Power: 5V tá»« USB (cho sensor vÃ  vi Ä‘iá»u khiá»ƒn)

---

## 2.2. SÆ¡ Ä‘á»“ nguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng MTTCN

*(Ná»™i dung sáº½ bá»• sung - váº½ flowchart)*

### 2.2.1. SÆ¡ Ä‘á»“ khá»‘i thuáº­t toÃ¡n tá»•ng thá»ƒ

```
START
  â”‚
  â”œâ”€> Initialize GUI (PyQt5 Main Window)
  â”‚
  â”œâ”€> Create Thread 1: SHT20 Communication
  â”‚   â”‚
  â”‚   â”œâ”€> Connect COM1 (9600 bps)
  â”‚   â”œâ”€> Loop (every 1 second):
  â”‚   â”‚   â”œâ”€> Send Modbus Request (Function 0x03/0x04)
  â”‚   â”‚   â”œâ”€> Receive Response
  â”‚   â”‚   â”œâ”€> Verify CRC-16
  â”‚   â”‚   â”œâ”€> Parse Temperature & Humidity
  â”‚   â”‚   â””â”€> Update GUI (emit signal)
  â”‚   â””â”€> Handle errors
  â”‚
  â”œâ”€> Create Thread 2: Ezi-STEP Communication
  â”‚   â”‚
  â”‚   â”œâ”€> Connect COM2 (115200 bps)
  â”‚   â”œâ”€> Loop (every 100 ms):
  â”‚   â”‚   â”œâ”€> Send FASTECH Command
  â”‚   â”‚   â”œâ”€> Apply Byte Stuffing
  â”‚   â”‚   â”œâ”€> Receive Response
  â”‚   â”‚   â”œâ”€> Apply Byte Destuffing
  â”‚   â”‚   â”œâ”€> Verify CRC-16
  â”‚   â”‚   â”œâ”€> Parse Position & Status
  â”‚   â”‚   â””â”€> Update GUI (emit signal)
  â”‚   â””â”€> Handle errors
  â”‚
  â”œâ”€> Data Logging Thread (optional)
  â”‚   â””â”€> Write CSV every 5 seconds
  â”‚
  â””â”€> Wait for user input / Exit
```

### 2.2.2. SÆ¡ Ä‘á»“ logic Ä‘iá»u khiá»ƒn

**Logic Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡:**
```
User clicks JOG CW button
  â”‚
  â”œâ”€> Check if SERVO ON
  â”‚   â”œâ”€> NO: Show error "Enable servo first"
  â”‚   â””â”€> YES: Continue
  â”‚
  â”œâ”€> Get speed from slider (5000-10000 pps)
  â”‚
  â”œâ”€> Build FASTECH packet:
  â”‚   â”œâ”€> SlaveID = 2
  â”‚   â”œâ”€> Command = 0x37 (MOVE_VELOCITY)
  â”‚   â”œâ”€> Data = [Speed (4 bytes LE) + Direction (1 byte)]
  â”‚   â”œâ”€> Calculate CRC-16
  â”‚   â””â”€> Apply Byte Stuffing
  â”‚
  â”œâ”€> Send packet via COM2
  â”‚
  â”œâ”€> Receive response
  â”‚   â”œâ”€> Apply Byte Destuffing
  â”‚   â””â”€> Check status (0x31 = OK, 0x46 = ALARM)
  â”‚
  â””â”€> Update GUI status display
```

---

## 2.3. CÃ¡ch thá»©c truyá»n nháº­n dá»¯ liá»‡u cá»§a há»‡ thá»‘ng

*(Ná»™i dung sáº½ bá»• sung - 3 vÃ­ dá»¥ cá»¥ thá»ƒ)*

### 2.3.1. Truyá»n nháº­n dá»¯ liá»‡u Master - Slave 1 (SHT20)

**Giao thá»©c:** Modbus RTU  
**Má»¥c Ä‘Ã­ch:** Äá»c nhiá»‡t Ä‘á»™ vÃ  Ä‘á»™ áº©m tá»« cáº£m biáº¿n

**Cáº¥u trÃºc packet:**
```
[Slave_ID][Function][Start_Addr_H][Start_Addr_L][Count_H][Count_L][CRC_L][CRC_H]
```

---

### 2.3.2. Truyá»n nháº­n dá»¯ liá»‡u Master - Slave 2 (Ezi-STEP)

**Giao thá»©c:** FASTECH Protocol  
**Má»¥c Ä‘Ã­ch:** Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡ bÆ°á»›c

**Cáº¥u trÃºc packet:**
```
[HEADER: 0xAA55] + [SlaveID + FrameType + Data + CRC](stuffed) + [TAIL: 0xAA0D]
```

**Äáº·c Ä‘iá»ƒm quan trá»ng:**
- **Byte Stuffing:** Má»i byte `0xAA` trong frame data pháº£i duplicate thÃ nh `0xAA 0xAA`
- **CRC-16:** TÃ­nh trÃªn `[SlaveID + FrameType + Data]` (khÃ´ng bao gá»“m header/tail)

---

### 2.3.3. Ba vÃ­ dá»¥ minh há»a chi tiáº¿t

#### **VÃ­ dá»¥ 1: Äá»c nhiá»‡t Ä‘á»™ tá»« SHT20 (Modbus RTU)**

**Request tá»« Master:**
```
01 03 00 01 00 01 D5 CA
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”´â”€> CRC-16 (0xD5CA)
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”´â”€â”€â”€â”€â”€> Count = 1 register
â”‚  â”‚  â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Start Address = 0x0001 (Temperature)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Function Code = 0x03 (Read Holding Registers)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Slave ID = 0x01
```

**Response tá»« Slave 1:**
```
01 03 02 01 08 B8 46
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”´â”€> CRC-16
â”‚  â”‚  â”‚  â””â”€â”€â”´â”€â”€â”€â”€â”€> Data = 0x0108 = 264 (26.4Â°C)
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Byte Count = 2
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Function Code = 0x03
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Slave ID = 0x01
```

**Giáº£i thÃ­ch:**
- Master gá»­i yÃªu cáº§u Ä‘á»c 1 register táº¡i Ä‘á»‹a chá»‰ 0x0001 (nhiá»‡t Ä‘á»™)
- Slave 1 tráº£ vá» giÃ¡ trá»‹ `0x0108` = 264
- Nhiá»‡t Ä‘á»™ thá»±c táº¿ = 264 / 10 = **26.4Â°C**

---

#### **VÃ­ dá»¥ 2: Servo ON Ä‘á»™ng cÆ¡ (FASTECH Protocol)**

**Request tá»« Master (trÆ°á»›c khi byte stuffing):**
```
Frame data: [02 83 D4 90]
â”‚           â”‚  â”‚  â””â”€â”´â”€> CRC-16 (0xD490)
â”‚           â”‚  â””â”€â”€â”€â”€â”€> Command = 0x83 (SERVO_ON)
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€> Slave ID = 0x02
```

**Sau khi byte stuffing (khÃ´ng cÃ³ 0xAA trong frame nÃªn khÃ´ng thay Ä‘á»•i):**
```
Frame data: [02 83 D4 90]
```

**Packet hoÃ n chá»‰nh:**
```
AA 55 02 83 D4 90 AA 0D
â””â”€â”´â”€> Header
      â””â”€â”€â”€â”€â”€â”€â”´â”€â”€> Frame data (stuffed)
                  â””â”€â”´â”€> Tail
```

**Response tá»« Slave 2:**
```
AA 55 02 31 DA 52 AA 0D
      â”‚  â”‚  â””â”€â”´â”€> CRC-16
      â”‚  â””â”€â”€â”€â”€â”€> Status = 0x31 (OK - servo enabled)
      â””â”€â”€â”€â”€â”€â”€â”€â”€> Slave ID = 0x02
```

**Giáº£i thÃ­ch:**
- Master gá»­i lá»‡nh SERVO_ON (0x83)
- Slave 2 tráº£ vá» status 0x31 (OK) â†’ Servo Ä‘Ã£ báº­t thÃ nh cÃ´ng

---

### 2.3.3. Bá»‘n vÃ­ dá»¥ minh há»a chi tiáº¿t

#### **VÃ­ dá»¥ 3: JOG Ä‘á»™ng cÆ¡ vá»›i byte stuffing (FASTECH Protocol)**

**Request tá»« Master (trÆ°á»›c khi byte stuffing):**
```
Frame data: [02 37 88 13 00 00 01 XX XX]
â”‚           â”‚  â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€> Speed = 0x00001388 = 5000 pps
â”‚           â”‚  â”‚              â””â”€> Direction = 0x01 (CW)
â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Command = 0x37 (MOVE_VELOCITY)
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Slave ID = 0x02
```

**Giáº£ sá»­ CRC tÃ­nh ra lÃ  `0xAA45` (chá»©a byte 0xAA):**
```
Frame data (trÆ°á»›c stuffing): [02 37 88 13 00 00 01 AA 45]
                                                    ^^
                                                    Cáº§n duplicate!
```

**Sau khi byte stuffing:**
```
Frame data (sau stuffing): [02 37 88 13 00 00 01 AA AA 45]
                                                   ^^  ^^
                                                   ÄÃ£ duplicate 0xAA
```

**Packet hoÃ n chá»‰nh:**
```
AA 55 02 37 88 13 00 00 01 AA AA 45 AA 0D
â””â”€â”´â”€> Header
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€> Frame data (stuffed)
                                    â””â”€â”´â”€> Tail
```

**Response tá»« Slave 2:**
```
AA 55 02 31 DA 52 AA 0D
      â”‚  â”‚  â””â”€â”´â”€> CRC-16
      â”‚  â””â”€â”€â”€â”€â”€> Status = 0x31 (OK - motor rotating)
      â””â”€â”€â”€â”€â”€â”€â”€â”€> Slave ID = 0x02
```

**Giáº£i thÃ­ch:**
- Master gá»­i lá»‡nh JOG vá»›i tá»‘c Ä‘á»™ 5000 pps, hÆ°á»›ng CW
- **Byte stuffing quan trá»ng:** CRC chá»©a byte 0xAA pháº£i duplicate thÃ nh 0xAA 0xAA
- Náº¿u khÃ´ng cÃ³ byte stuffing â†’ Slave sáº½ parse sai (nháº§m 0xAA vá»›i header/tail)
- Slave 2 tráº£ vá» status 0x31 (OK) â†’ Motor Ä‘ang quay

---

**VÃ­ dá»¥ 4: Move Absolute vá»›i JOG Simulation**

**Váº¥n Ä‘á»:** Lá»‡nh MOVE_ABSOLUTE (0x38) bá»‹ driver tá»« chá»‘i vá»›i response 0x82 (ACK + ERROR)

**NguyÃªn nhÃ¢n:** Lá»‡nh cáº§n tham sá»‘ acceleration/deceleration time khÃ´ng cÃ³ trong tÃ i liá»‡u

**Giáº£i phÃ¡p - JOG Simulation:**

```python
def move_absolute(position, speed):
    # BÆ°á»›c 1: TÃ­nh khoáº£ng cÃ¡ch
    distance = position - current_position
    direction = 1 if distance > 0 else 0
    
    # BÆ°á»›c 2: Gá»­i lá»‡nh JOG (0x37)
    jog_move(speed, direction, is_simulation=True)
    
    # BÆ°á»›c 3: TÃ­nh thá»i gian chÃ­nh xÃ¡c
    move_time = abs(distance) / speed
    
    # BÆ°á»›c 4: Chá» Ä‘Ãºng thá»i gian
    time.sleep(move_time)
    
    # BÆ°á»›c 5: Dá»«ng motor
    stop()
    
    # BÆ°á»›c 6: Cáº­p nháº­t vá»‹ trÃ­
    current_position = position
```

**VÃ­ dá»¥ cá»¥ thá»ƒ:**
- **Vá»‹ trÃ­ hiá»‡n táº¡i:** 0 pulse
- **Vá»‹ trÃ­ Ä‘Ã­ch:** 10000 pulse
- **Tá»‘c Ä‘á»™:** 10000 pps
- **Thá»i gian:** 10000 / 10000 = **1.0 giÃ¢y**
- **Káº¿t quáº£:** Motor di chuyá»ƒn **chÃ­nh xÃ¡c 10000 pulse** trong 1 giÃ¢y

**So sÃ¡nh vá»›i lá»‡nh trá»±c tiáº¿p:**
| PhÆ°Æ¡ng phÃ¡p | Æ¯u Ä‘iá»ƒm | NhÆ°á»£c Ä‘iá»ƒm |
|-------------|---------|------------|
| MOVE_ABSOLUTE (0x38) | Chuáº©n, cÃ³ gia tá»‘c | Bá»‹ driver tá»« chá»‘i, cáº§n params phá»©c táº¡p |
| **JOG Simulation** | **Hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh** | KhÃ´ng cÃ³ gia tá»‘c/giáº£m tá»‘c (dá»«ng Ä‘á»™t ngá»™t) |

**LÆ°u Ã½ quan trá»ng:**
- Flag `is_simulation=True`: KhÃ´ng track position trong `stop()` (trÃ¡nh tÃ­nh trÃ¹ng láº·p)
- Flag `is_simulation=False`: Track position cho JOG thuáº§n tÃºy (báº¥m giá»¯ nÃºt)
- Tá»‘c Ä‘á»™ HOME: 50000 pps (cá»‘ Ä‘á»‹nh, nhanh vá» gá»‘c)

---

### 2.4. Há»‡ thá»‘ng Automation thÃ´ng minh

#### 2.4.1. Kiáº¿n trÃºc Automation System

**Tá»•ng quan:**
Há»‡ thá»‘ng automation tÃ­ch há»£p dá»¯ liá»‡u tá»« cáº£ 2 máº¡ng (SHT20 vÃ  Ezi-STEP) Ä‘á»ƒ tá»± Ä‘á»™ng Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡ dá»±a trÃªn Ä‘iá»u kiá»‡n mÃ´i trÆ°á»ng.

**Luá»“ng dá»¯ liá»‡u:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SHT20     â”‚ â”€â”€â–º Temp/Humid â”€â”€â”
â”‚ (Máº¡ng 1)    â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  Automation  â”‚ â”€â”€â”€â–º â”‚  Ezi-STEP   â”‚
                           â”‚  Controller  â”‚      â”‚  (Máº¡ng 2)   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–²
                                   â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚     GUI      â”‚
                           â”‚ (Config Tab) â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.4.2. CÃ¡c quy táº¯c automation (Rules)

**Rule 1: High Temperature Motor Start**
- **Äiá»u kiá»‡n:** Nhiá»‡t Ä‘á»™ > threshold (máº·c Ä‘á»‹nh: 28Â°C)
- **HÃ nh Ä‘á»™ng:** Báº­t motor CW vá»›i tá»‘c Ä‘á»™ cáº¥u hÃ¬nh (máº·c Ä‘á»‹nh: 8000 pps)
- **Ã nghÄ©a:** Khi nhiá»‡t Ä‘á»™ cao, báº­t quáº¡t lÃ m mÃ¡t

**Rule 2: Low Temperature Motor Stop**
- **Äiá»u kiá»‡n:** Nhiá»‡t Ä‘á»™ < threshold (máº·c Ä‘á»‹nh: 26Â°C)
- **HÃ nh Ä‘á»™ng:** Dá»«ng motor
- **Ã nghÄ©a:** Khi nhiá»‡t Ä‘á»™ Ä‘Ã£ giáº£m Ä‘á»§, táº¯t quáº¡t tiáº¿t kiá»‡m nÄƒng lÆ°á»£ng

**Rule 3: High Humidity Motor Stop**
- **Äiá»u kiá»‡n:** Äá»™ áº©m > threshold (máº·c Ä‘á»‹nh: 65%)
- **HÃ nh Ä‘á»™ng:** Dá»«ng motor
- **Ã nghÄ©a:** Khi Ä‘á»™ áº©m cao, táº¯t mÃ¡y phun sÆ°Æ¡ng

**Rule 4: Low Humidity Motor Start**
- **Äiá»u kiá»‡n:** Äá»™ áº©m < threshold (máº·c Ä‘á»‹nh: 40%)
- **HÃ nh Ä‘á»™ng:** Báº­t motor CW vá»›i tá»‘c Ä‘á»™ cáº¥u hÃ¬nh (máº·c Ä‘á»‹nh: 5000 pps)
- **Ã nghÄ©a:** Khi Ä‘á»™ áº©m tháº¥p, báº­t mÃ¡y phun sÆ°Æ¡ng

#### 2.4.3. TÃ­nh nÄƒng nÃ¢ng cao

**1. Dynamic Parameter Configuration**
- Thay Ä‘á»•i threshold real-time qua GUI
- Pháº¡m vi nhiá»‡t Ä‘á»™: 0-80Â°C (phÃ¹ há»£p mÃ´i trÆ°á»ng cÃ´ng nghiá»‡p)
- Pháº¡m vi Ä‘á»™ áº©m: 0-100%
- Pháº¡m vi tá»‘c Ä‘á»™: 1,000-50,000 pps
- Cáº­p nháº­t ngay láº­p tá»©c mÃ  khÃ´ng cáº§n restart

**2. Motor State Tracking**
- `is_running`: Boolean flag theo dÃµi motor cÃ³ Ä‘ang cháº¡y
- `current_speed`: Tá»‘c Ä‘á»™ hiá»‡n táº¡i (pps)
- ÄÆ°á»£c cáº­p nháº­t trong `jog_move()` vÃ  `stop()`
- DÃ¹ng Ä‘á»ƒ kiá»ƒm tra Ä‘iá»u kiá»‡n rules (trÃ¡nh gá»­i lá»‡nh trÃ¹ng láº·p)

**3. Automation Safety**
- **Táº¯t automation â†’ Dá»«ng motor:** Khi ngÆ°á»i dÃ¹ng táº¯t checkbox automation, motor tá»± Ä‘á»™ng dá»«ng ngay láº­p tá»©c
- **ÄÃ³ng chÆ°Æ¡ng trÃ¬nh â†’ Dá»«ng motor:** Cleanup function trong `closeEvent()` Ä‘áº£m báº£o motor khÃ´ng tiáº¿p tá»¥c cháº¡y
- **Exception handling:** Try-catch blocks báº£o vá»‡ khá»i lá»—i giao tiáº¿p

**4. Activity Logging**
- Timestamp chi tiáº¿t cho má»—i event
- MÃ u sáº¯c phÃ¢n biá»‡t (xanh: success, Ä‘á»: error, xÃ¡m: info)
- Auto-scroll Ä‘áº¿n dÃ²ng má»›i nháº¥t
- Clear log vÃ  reset statistics

**5. Statistics Dashboard**
- **Total Triggers:** Tá»•ng sá»‘ láº§n rules Ä‘Æ°á»£c kÃ­ch hoáº¡t
- **Active Rules:** Sá»‘ rules Ä‘ang báº­t / tá»•ng sá»‘ rules
- **Rule-specific stats:** Má»—i rule cÃ³ trigger count riÃªng
- **Last Trigger Time:** Thá»i gian trigger gáº§n nháº¥t

#### 2.4.4. Code implementation

**AutomationController class:**
```python
class AutomationController(QObject):
    # Signals
    action_executed = pyqtSignal(str, str, bool)  # (rule_name, message, success)
    status_changed = pyqtSignal(bool)  # (enabled/disabled)
    
    def process_sensor_data(self, temperature, humidity, motor_status):
        """Xá»­ lÃ½ dá»¯ liá»‡u tá»« sensor vÃ  kiá»ƒm tra rules"""
        if not self.enabled:
            return
            
        for rule in self.rules:
            if not rule.enabled:
                continue
            
            # Kiá»ƒm tra Ä‘iá»u kiá»‡n
            if rule.check_condition(temperature, humidity, motor_status):
                # Thá»±c hiá»‡n action
                success, message = rule.execute_action()
                if success:
                    self.total_triggers += 1
                    self.action_executed.emit(rule.name, message, True)
```

**Rule example:**
```python
class HighTempMotorStartRule(AutomationRule):
    def check_condition(self, temperature, humidity, motor_status):
        return (temperature > self.temp_threshold and 
                motor_status.get('running', False) == False)
                
    def execute_action(self):
        self.motor_controller.jog_move(self.motor_speed, direction=1)
        return True, f"Motor started CW at {self.motor_speed}pps"
```

#### 2.4.5. VÃ­ dá»¥ hoáº¡t Ä‘á»™ng thá»±c táº¿

**TÃ¬nh huá»‘ng:** Nhiá»‡t Ä‘á»™ phÃ²ng tÄƒng dáº§n tá»« 25Â°C lÃªn 30Â°C

| Thá»i gian | Nhiá»‡t Ä‘á»™ | Sá»± kiá»‡n | Log |
|-----------|----------|---------|-----|
| 10:00:00 | 25.0Â°C | - | Automation enabled |
| 10:01:15 | 28.5Â°C | Rule 1 trigger | ğŸ¤– AUTO [High Temperature Motor Start]: Temp=28.5Â°C â†’ Motor started CW at 8000pps |
| 10:03:30 | 30.2Â°C | Motor Ä‘ang cháº¡y | (khÃ´ng trigger láº¡i - motor Ä‘Ã£ cháº¡y) |
| 10:05:00 | User táº¯t automation | Rule ngá»«ng hoáº¡t Ä‘á»™ng | ğŸ›‘ ÄÃ£ dá»«ng motor khi táº¯t automation |

**Log chi tiáº¿t:**
```
[10:00:00] ğŸ¤– ÄÃ£ báº­t Ä‘iá»u khiá»ƒn tá»± Ä‘á»™ng
[10:01:15] âœ… High Temperature Motor Start: Motor started CW at 8000pps
[10:01:15] ğŸ¤– AUTO [High Temperature Motor Start]: Temp=28.5Â°C, Humid=62.0% â†’ Motor started CW at 8000pps
[10:05:00] ğŸ¤– ÄÃ£ táº¯t Ä‘iá»u khiá»ƒn tá»± Ä‘á»™ng
[10:05:00] ğŸ›‘ ÄÃ£ dá»«ng motor khi táº¯t automation
```

---
---

# CHÆ¯Æ NG 3. Káº¾T LUáº¬N

## 3.1. TÃ³m táº¯t má»¥c tiÃªu vÃ  ná»™i dung Ä‘Ã£ thá»±c hiá»‡n

*(Ná»™i dung sáº½ bá»• sung)*

**Má»¥c tiÃªu ban Ä‘áº§u:**
- XÃ¢y dá»±ng há»‡ thá»‘ng giÃ¡m sÃ¡t mÃ´i trÆ°á»ng vÃ  Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡
- Sá»­ dá»¥ng 2 máº¡ng RS-485 Ä‘á»™c láº­p vá»›i cÃ¡c giao thá»©c khÃ¡c nhau
- Giao diá»‡n Ä‘á»“ há»a ngÆ°á»i dÃ¹ng vá»›i hiá»ƒn thá»‹ real-time
- Data logging vÃ  xá»­ lÃ½ lá»—i

**Ná»™i dung Ä‘Ã£ thiáº¿t káº¿/cáº¥u hÃ¬nh:**
- Máº¡ng 1 (Modbus RTU @ 9600 bps): GiÃ¡m sÃ¡t nhiá»‡t Ä‘á»™ vÃ  Ä‘á»™ áº©m tá»« cáº£m biáº¿n SHT20
- Máº¡ng 2 (FASTECH Protocol @ 115200 bps): Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡ bÆ°á»›c Ezi-STEP Plus-R
- á»¨ng dá»¥ng Python vá»›i PyQt5 GUI (3 tabs: GiÃ¡m sÃ¡t, Äiá»u khiá»ƒn, Tá»± Ä‘á»™ng)
- Multi-threading Ä‘á»ƒ giao tiáº¿p song song 2 máº¡ng
- **Há»‡ thá»‘ng automation thÃ´ng minh:** 4 quy táº¯c Ä‘iá»u khiá»ƒn dá»±a trÃªn nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m

---

## 3.2. ÄÃ¡nh giÃ¡ nhá»¯ng gÃ¬ Ä‘Ã£ lÃ m Ä‘Æ°á»£c

*(Ná»™i dung sáº½ bá»• sung)*

**Vá» pháº§n cá»©ng:**
- âœ… Káº¿t ná»‘i thÃ nh cÃ´ng 2 máº¡ng RS-485 qua USB-Serial converter
- âœ… Cáº¥u hÃ¬nh tá»‘c Ä‘á»™ truyá»n vÃ  thÃ´ng sá»‘ serial Ä‘Ãºng cho má»—i máº¡ng
- âœ… Nguá»“n Ä‘iá»‡n á»•n Ä‘á»‹nh cho driver vÃ  Ä‘á»™ng cÆ¡

**Vá» pháº§n má»m:**
- âœ… Triá»ƒn khai driver Modbus RTU hoÃ n chá»‰nh cho SHT20
- âœ… Triá»ƒn khai driver FASTECH Protocol vá»›i byte stuffing/destuffing
- âœ… **JOG Simulation:** Giáº£i phÃ¡p sÃ¡ng táº¡o Ä‘á»ƒ bypass lá»‡nh MOVE bá»‹ tá»« chá»‘i
- âœ… **Tá»‘c Ä‘á»™ linh hoáº¡t:** 2 Ã´ tá»‘c Ä‘á»™ riÃªng (JOG: 20000pps, Move: 10000pps, Home: 50000pps)
- âœ… XÃ¢y dá»±ng GUI 3 tabs vá»›i PyQt5 (SHT20, Motor Control, Automation)
- âœ… **Há»‡ thá»‘ng automation thÃ´ng minh:** 4 quy táº¯c vá»›i giao diá»‡n cáº¥u hÃ¬nh linh hoáº¡t
- âœ… **Motor state tracking:** Theo dÃµi tráº¡ng thÃ¡i Ä‘á»™ng cÆ¡ (is_running, current_speed)
- âœ… **Automation safety:** Tá»± Ä‘á»™ng dá»«ng motor khi táº¯t automation hoáº·c Ä‘Ã³ng chÆ°Æ¡ng trÃ¬nh
- âœ… **Dynamic parameter adjustment:** Thay Ä‘á»•i threshold vÃ  tá»‘c Ä‘á»™ real-time
- âœ… Multi-threading á»•n Ä‘á»‹nh khÃ´ng xung Ä‘á»™t
- âœ… Real-time plotting vá»›i PyQtGraph
- âœ… Data logging ra CSV file
- âœ… Position tracking chÃ­nh xÃ¡c (phÃ¢n biá»‡t JOG thuáº§n tÃºy vs simulation)
- âœ… Activity log chi tiáº¿t cho automation events

**Vá» giao thá»©c:**
- âœ… Hiá»ƒu rÃµ cáº¥u trÃºc Modbus RTU (function codes, CRC-16)
- âœ… Hiá»ƒu rÃµ FASTECH Protocol (byte stuffing, frame structure)
- âœ… Xá»­ lÃ½ CRC-16 checksum chÃ­nh xÃ¡c
- âœ… Debugging vÃ  phÃ¢n tÃ­ch packet thÃ nh cÃ´ng

---

## 3.3. ÄÃ¡nh giÃ¡ Æ°u nhÆ°á»£c Ä‘iá»ƒm cá»§a Ä‘á» tÃ i

*(Ná»™i dung sáº½ bá»• sung)*

### **Æ¯u Ä‘iá»ƒm:**

**1. Vá» kiáº¿n trÃºc há»‡ thá»‘ng:**
- âœ… Hai máº¡ng Ä‘á»™c láº­p: khÃ´ng áº£nh hÆ°á»Ÿng láº«n nhau, tÄƒng Ä‘á»™ tin cáº­y
- âœ… Multi-threading hiá»‡u quáº£: GUI khÃ´ng bá»‹ lag khi giao tiáº¿p
- âœ… Dá»… dÃ ng má»Ÿ rá»™ng: cÃ³ thá»ƒ thÃªm thiáº¿t bá»‹ má»›i vÃ o má»—i máº¡ng

**2. Vá» giao thá»©c:**
- âœ… Modbus RTU: giao thá»©c chuáº©n cÃ´ng nghiá»‡p, tÃ i liá»‡u phong phÃº
- âœ… RS-485: khoáº£ng cÃ¡ch xa (1200m), chá»‘ng nhiá»…u tá»‘t, nhiá»u slave

**3. Vá» giao diá»‡n:**
- âœ… Trá»±c quan, dá»… sá»­ dá»¥ng vá»›i PyQt5
- âœ… Äá»“ thá»‹ real-time hiá»ƒn thá»‹ rÃµ rÃ ng
- âœ… Logging dá»¯ liá»‡u tiá»‡n lá»£i cho phÃ¢n tÃ­ch sau

### **NhÆ°á»£c Ä‘iá»ƒm:**

**1. Vá» pháº§n cá»©ng:**
- âŒ Cáº§n 2 cá»•ng COM riÃªng biá»‡t (2 USB-Serial converter)
- âŒ Chi phÃ­ cao hÆ¡n so vá»›i máº¡ng Ä‘Æ¡n
- âŒ Cáº§n nguá»“n Ä‘iá»‡n 24V riÃªng cho driver Ä‘á»™ng cÆ¡

**2. Vá» giao thá»©c:**
- âŒ FASTECH Protocol phá»©c táº¡p (byte stuffing, proprietary)
- âŒ TÃ i liá»‡u FASTECH Ã­t, khÃ³ debug
- âŒ KhÃ´ng tÆ°Æ¡ng thÃ­ch vá»›i thiáº¿t bá»‹ khÃ¡c nhÃ  sáº£n xuáº¥t

**3. Vá» cáº¥u hÃ¬nh:**
- âŒ Driver Ezi-STEP yÃªu cáº§u parameter configuration phá»©c táº¡p
- âŒ Homing requirement lÃ m phá»©c táº¡p logic Ä‘iá»u khiá»ƒn

---

## 3.4. Má»©c Ä‘á»™ hoÃ n thÃ nh so vá»›i yÃªu cáº§u

*(Ná»™i dung sáº½ bá»• sung)*

| YÃªu cáº§u | Tráº¡ng thÃ¡i | Ghi chÃº |
|---------|-----------|---------|
| Káº¿t ná»‘i 2 máº¡ng RS-485 Ä‘á»™c láº­p | âœ… 100% | COM1 (SHT20) + COM2 (Ezi-STEP) |
| Giao thá»©c Modbus RTU | âœ… 100% | Äá»c dá»¯ liá»‡u chÃ­nh xÃ¡c |
| Giao thá»©c FASTECH | âœ… 100% | Byte stuffing/destuffing hoÃ n thiá»‡n |
| GiÃ¡m sÃ¡t nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m | âœ… 100% | Real-time, chÃ­nh xÃ¡c |
| Äiá»u khiá»ƒn Ä‘á»™ng cÆ¡ | âœ… 100% | JOG, ABS, DEC, INC, HOME hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c |
| JOG Simulation | âœ… 100% | Giáº£i phÃ¡p sÃ¡ng táº¡o, vá»‹ trÃ­ chÃ­nh xÃ¡c |
| Position Tracking | âœ… 100% | PhÃ¢n biá»‡t JOG thuáº§n tÃºy vs simulation |
| GUI PyQt5 | âœ… 100% | 3 tabs (SHT20, Motor, Automation), responsive |
| Data logging | âœ… 100% | CSV format, timestamp |
| **Automation System** | âœ… 100% | **4 rules vá»›i 8 tham sá»‘ Ä‘iá»u chá»‰nh Ä‘Æ°á»£c** |
| **Automation Rules** | âœ… 100% | Temp >28Â°Câ†’Motor CW, Temp <26Â°Câ†’Stop |
| **Dynamic Configuration** | âœ… 100% | Threshold: 0-80Â°C, 0-100%, Speed: 1k-50k pps |
| **Motor Safety** | âœ… 100% | Auto-stop khi táº¯t automation/Ä‘Ã³ng app |
| **Activity Logging** | âœ… 100% | Real-time log vá»›i timestamp vÃ  mÃ u sáº¯c |
| **Statistics Dashboard** | âœ… 100% | Trigger count, active rules, motor status |
| Xá»­ lÃ½ lá»—i | âœ… 100% | CRC, timeout, exception handling |

**Tá»•ng káº¿t:** Äáº¡t **100%** yÃªu cáº§u Ä‘á» ra + **VÆ°á»£t mong Ä‘á»£i** vá»›i há»‡ thá»‘ng automation thÃ´ng minh, an toÃ n vÃ  linh hoáº¡t.

---

## 3.5. Äá» xuáº¥t phÃ¡t triá»ƒn trong tÆ°Æ¡ng lai

*(Ná»™i dung sáº½ bá»• sung)*

**1. NÃ¢ng cáº¥p pháº§n cá»©ng:**
- ThÃªm nhiá»u slave vÃ o má»—i máº¡ng (nhiá»u cáº£m biáº¿n, nhiá»u Ä‘á»™ng cÆ¡)
- Sá»­ dá»¥ng RS-485 isolator Ä‘á»ƒ tÄƒng Ä‘á»™ tin cáº­y
- ThÃªm mÃ n hÃ¬nh HMI Ä‘á»ƒ giÃ¡m sÃ¡t táº¡i hiá»‡n trÆ°á»ng

**2. NÃ¢ng cáº¥p pháº§n má»m:**
- ThÃªm cáº£nh bÃ¡o qua email/SMS khi nhiá»‡t Ä‘á»™ vÆ°á»£t ngÆ°á»¡ng
- LÆ°u database (SQLite/MySQL) thay vÃ¬ CSV
- Web dashboard Ä‘á»ƒ giÃ¡m sÃ¡t tá»« xa (Flask/Django)
- Machine learning Ä‘á»ƒ dá»± Ä‘oÃ¡n xu hÆ°á»›ng nhiá»‡t Ä‘á»™/Ä‘á»™ áº©m

**3. TÃ­nh nÄƒng má»›i:**
- PID control cho Ä‘á»™ng cÆ¡ (vá»‹ trÃ­ chÃ­nh xÃ¡c)
- Recipe system (lÆ°u chuá»—i lá»‡nh Ä‘á»™ng cÆ¡)
- Backup/restore configuration
- User authentication (Ä‘Äƒng nháº­p)

**4. TÃ­ch há»£p IoT:**
- MQTT protocol Ä‘á»ƒ káº¿t ná»‘i cloud
- Grafana dashboard cho visualization
- Mobile app (Android/iOS)

**5. Cáº£i thiá»‡n giao thá»©c:**
- Thá»­ nghiá»‡m Modbus TCP/IP (qua Ethernet)
- So sÃ¡nh hiá»‡u suáº¥t vá»›i EtherCAT, PROFINET
- ThÃªm mÃ£ hÃ³a dá»¯ liá»‡u (security)

---
---

# TÃ€I LIá»†U THAM KHáº¢O

1. **Modbus Protocol Specification v1.1b3** - Modbus Organization, 2012.
   
2. **FASTECH Ezi-STEP Plus-R Communication Manual** - Fastech Co., Ltd., 2020.
   
3. **TIA/EIA-485-A Standard: Electrical Characteristics of Generators and Receivers for Use in Balanced Digital Multipoint Systems** - Telecommunications Industry Association, 1998.
   
4. **PyQt5 Reference Guide** - Riverbank Computing Limited. [Online]. Available: https://www.riverbankcomputing.com/static/Docs/PyQt5/

5. **pymodbus Documentation** - pymodbus contributors. [Online]. Available: https://pymodbus.readthedocs.io/

6. **PySerial Documentation: Python Serial Communication** - Python Software Foundation. [Online]. Available: https://pythonhosted.org/pyserial/

7. **RS-485 Design Guide** - Texas Instruments Application Report, SLLA070D, 2008.

8. Äáº·ng Anh Viá»‡t, Nguyá»…n Quang NhÃ£, **"BÃ i giáº£ng Kiáº¿n trÃºc mÃ¡y tÃ­nh vÃ  máº¡ng truyá»n thÃ´ng cÃ´ng nghiá»‡p"**, TrÆ°á»ng Äáº¡i há»c CÃ´ng nghá»‡ - ÄHQGHN, 2024.

---
---

# PHá»¤ Lá»¤C

## Phá»¥ lá»¥c A: ChÆ°Æ¡ng trÃ¬nh code Ä‘áº§y Ä‘á»§

*(Ná»™i dung sáº½ bá»• sung - source code cÃ¡c file chÃ­nh)*

### A.1. File cáº¥u hÃ¬nh: `config/settings.py`
```python
# Ná»™i dung code...
```

### A.2. Driver SHT20: `drivers/sht20_modbus.py`
```python
# Ná»™i dung code...
```

### A.3. Driver Ezi-STEP: `drivers/ezistep_fastech.py`
```python
# Ná»™i dung code...
```

### A.4. GUI chÃ­nh: `gui/main_window.py`
```python
# Ná»™i dung code...
```

---

## Phá»¥ lá»¥c B: HÃ¬nh áº£nh mÃ´ hÃ¬nh thá»±c táº¿

*(Ná»™i dung sáº½ bá»• sung - áº£nh chá»¥p pháº§n cá»©ng, káº¿t ná»‘i, GUI)*

### B.1. SÆ¡ Ä‘á»“ káº¿t ná»‘i pháº§n cá»©ng
![Hardware Connection Diagram]

### B.2. Giao diá»‡n á»©ng dá»¥ng
![GUI Screenshot - SHT20 Tab]
![GUI Screenshot - Ezi-STEP Tab]

### B.3. Thiáº¿t bá»‹ thá»±c táº¿
![SHT20 Sensor]
![Ezi-STEP Driver and Motor]
![USB-Serial Converters]

---

## Phá»¥ lá»¥c C: Datasheet thiáº¿t bá»‹

*(Ná»™i dung sáº½ bá»• sung - tÃ³m táº¯t thÃ´ng sá»‘ ká»¹ thuáº­t)*

### C.1. SHT20 Temperature & Humidity Sensor
- **Manufacturer:** Sensirion AG
- **Temperature Range:** -40Â°C to +125Â°C
- **Humidity Range:** 0% to 100% RH
- **Accuracy:** Â±0.3Â°C (typ), Â±3% RH (typ)
- **Interface:** I2C or Modbus RTU

### C.2. Ezi-STEP Plus-R Driver (Model: EzT-NDR-42M)
- **Manufacturer:** Fastech Co., Ltd.
- **Motor Type:** 2-phase stepper motor
- **Max Current:** 4.2A/phase
- **Voltage:** 24-48V DC
- **Interface:** RS-485 (FASTECH Protocol)
- **Resolution:** 1000 pulse/rev (default)

### C.3. USB-Serial Converters
- **CH340:** 9600-2Mbps, USB 2.0
- **FTDI FT232RL:** 300-3Mbps, USB 2.0

---

**NgÃ y hoÃ n thÃ nh:** ThÃ¡ng 11/2025  
**Äá»‹a Ä‘iá»ƒm:** TrÆ°á»ng Äáº¡i há»c CÃ´ng nghá»‡ - ÄHQGHN

---

*ÄÃ¢y lÃ  bÃ i táº­p lá»›n mÃ´n há»c, khÃ´ng dÃ¹ng cho má»¥c Ä‘Ã­ch thÆ°Æ¡ng máº¡i.*
